[2026-01-24 19:13:21] pnpm why drizzle-orm
  Description: Check drizzle-orm dependency versions
[2026-01-24 19:24:23] pnpm why drizzle-orm 2>/dev/null | head -40
  Description: Check drizzle-orm version conflicts
[2026-01-24 19:25:25] cat pnpm-lock.yaml | grep -A 5 "drizzle-orm@" | head -30
  Description: Check drizzle-orm versions in lockfile
[2026-01-24 19:25:30] grep -r "@cloudflare/workers-types" apps/*/package.json packages/*/package.json 2>/dev/null
  Description: Find workers-types version mismatches
[2026-01-24 19:29:34] pnpm install --no-frozen-lockfile
  Description: Update lockfile to deduplicate drizzle-orm versions
[2026-01-24 19:29:51] find apps/app-worker/api/repositories -name '*.ts' -exec grep -l 'createDb(db)' {} \;
  Description: Find all repository files still using createDb
[2026-01-24 19:29:58] cd apps/app-worker/api/repositories && for file in incidents.ts teams.ts status-pages.ts notification-policies.ts auth.ts; do echo "=== $file ==="; grep -n "createDb\|D1Database\|DrizzleD1Database" "$file" | head -10; done
  Description: Check which files need updating
[2026-01-24 19:30:04] for file in apps/app-worker/api/repositories/{incidents,teams,status-pages,notification-policies,auth}.ts; do echo "=== $(basename $file) ==="; grep -n "createDb\|D1Database\|DrizzleD1Database" "$file" 2>/dev/null | head -5; done
  Description: Check repository files
[2026-01-24 19:30:16] cat > /tmp/update_repos.sh << 'EOF'
#!/bin/bash
for file in apps/app-worker/api/repositories/{incidents,teams,status-pages,notification-policies,auth}.ts; do
  # Replace createDb import
  sed -i '' 's/import { createDb, /import { /g' "$file"
  sed -i '' 's/, createDb/ /g' "$file"
  
  # Replace D1Database with DrizzleD1Database and add import
  sed -i '' 's/^import type { D1Database/import type { DrizzleD1Database/g' "$file"
  sed -i '' 's/db: D1Database/db: DrizzleD1Database/g' "$file"
  sed -i '' 's/d1: D1Database/d1: DrizzleD1Database/g' "$file"
  
  # Add DrizzleD1Database import if not present
  if ! grep -q "DrizzleD1Database" "$file"; then
    sed -i '' '1s/$/\nimport type { DrizzleD1Database } from "drizzle-orm\/d1";/' "$file"
  fi
  
  # Remove createDb() calls
  sed -i '' 's/const dbClient = createDb(db);/  \/\/ Using db directly/g' "$file"
  sed -i '' 's/const db = createDb(d1);/  \/\/ Using d1 directly/g' "$file"
  sed -i '' 's/dbClient\./db./g' "$file"
  sed -i '' 's/ db\. / d1./g' "$file" 
done
EOF
chmod +x /tmp/update_repos.sh
/tmp/update_repos.sh
  Description: Batch update repository files
